---
title: Extracorporeal CPR for Refractory Out-of-Hospital Cardiac Arrest
subtitle: A Bayesian Perspective
author:
  - name: James M Brophy
    email: james.brophy@mcgill.ca
    affiliations: 
        - id: McGill University 
          name: McGill University Health Center
          department: Centre for Health Outcomes Research (CORE) 
          address: 5252 Boul. de Maisonneuve West Room 2B.37
          city: Montreal
          state: QC
          postal-code: H4A 3S5
    attributes:
        corresponding: true
    note: JMB is a research scholar supported by Les Fonds de Recherche Québec Santé
abstract: |
  A recent randomized clinical trial reported in patients with refractory out-of-hospital cardiac arrest, extracorporeal CPR and conventional CPR had similar effects on survival with a favorable neurologic outcome. Herein, it is examined whether a Bayesian perspective allows any additional insights into the interpretation of this trial.
keywords: 
  - extracorporeal CPR
  - Bayesian statistics
date: last-modified
bibliography: bibliography.bib
format:
  elsevier-pdf:
    keep-tex: true
    journal:
      name: To be determined
      formatting: preprint
      model: 3p
      cite-style: super
editor: 
  markdown: 
    wrap: 72
---


```{r echo=FALSE,  message=FALSE, warning=FALSE, include=FALSE, results='hide'}
knitr::opts_chunk$set(echo = FALSE)
options(scipen = 1, digits = 3)
pander::panderOptions('keep.trailing.zeros', TRUE)

library(here)
library(tidyverse)
library(broom)
library(cobalt)
library(table1)
library(knitr)
library(patchwork)
library(rstanarm)
library(tidybayes)
library(gt)

```

# Introduction

Out-of-hospital cardiac arrest is a frequent event and fortunately its
devastating consequences can be partially mitigated by rapid
commencement of basic life support with high-quality chest compressions
and external defibrillation (conventional cardiopulmonary resuscitation
(CPR)). However, there remains a substantial subset of individuals who
do not respond rapidly to these measures and whether more invasive
measures. Whether the addition of more aggressive measure including
extracorporeal CPR (the addition of extracorporeal membrane oxygenation
to standard advanced cardiac life support (eCPR)) can improve survival and
diminish anoxic brain injury is a current topic of research. The largest
randomized clinical trial (RCT) examining this question recently
published their results[@CPR2023a]. For the primary outcome, 30 day
survival without significant neurological deficit, the authors observed
an odds ratio of 1.4 (95% confidence interval, 0.5 to 3.5; P = 0.52) in
favor of extracorporeal CPR for leading to their conclusion "In patients
with refractory out-of-hospital cardiac arrest, extracorporeal CPR and
conventional CPR had similar effects on survival with a favorable
neurological outcome".[@CPR2023a]

This communication does not reiterate the many reasons to be wary of
null hypothesis significance testing (NHST), p values and confidence
intervals[@RN5420]. Rather it assumes the reader has perhaps heard that
Bayesian methods mirror our intuitive learning process and is curious
about its potential application to RCT interpretations.

Therefore the goal of this communication is to examine whether a
Bayesian perspective permits additional insights into the specific
clinical question regarding any added value of extracorporeal CPR
following an out-of-hospital arrest in patients refractory to standard
CPR.

# Methods

The data for the primary outcome, 30 day survival with intact
neurological status, based on an intention to treat (ITT) analysis was
abstracted from the original INCEPTION trial [@CPR2023a] and used for
the primary analysis. The ITT analysis has the advantage of minimizing
bias by preserving the prognostic balance afforded by randomization as
well as assuring the validity of the statistical analyses. 

Bayesian analytical approaches provide a number of benefits over the
classical NHST approach, including parameter estimation accompanied by
direct probability statements about parameters of interest (herein the
risk of survival with intact neurological status), and the incorporation
prior knowledge [@BrophyCardio; @Zampieri].

These probability statements arise from the posterior distribution
according to the following equation:
$$ \text{Posterior}  = \frac{\text{Probability of the data} * \text{Prior}}{\text{Normalizing Constant}} $$

Therefore, in addition to the current data summarized by the probability
of the data (likelihood function) one requires a prior probability
distribution for each parameter. The mechanics of the Bayesian analyses
were performed using the Stan programming language [@stan] through the R
package rstanarm [@rstanarm] and fit a logistic regression model with a
single treatment parameter, $\theta$. Because our focus is the
interpretation of the INCEPTION trial alone, our primary analysis used
rstanarm's default vague parameter priors
($log(\theta) \sim Normal [0, 2.50]$, thereby assuring that the
posterior distribution is dominated by the observed INCEPTION data.

The robustness of the Bayesian approach is often assessed by sensitivity
analyses that examine the variation in the posterior probability as a
function of the choice of different prior distributions. Using prior
information also underscores the important advantage of Bayesian
analyses to learn sequentially. There were two previous RCTs examining
extracorporeal CPR[@RN6759; @RN6751] and while the protocols are not
identical, it may be reasonable to allow this data to serve as 
informed priors for the eCPR parameter, which can be updated with the INCEPTION data.    

This prior
information of the probability of eCPR success in each previous trial, $X_i$, can be summarized as a normal distribution with a mean equal to the proportion of successes, $\hat{p_i}$ with a standard deviation equal to $$\sqrt{\hat{p_i}*(1-\hat{p_i})}$$ 
As  baseline success rates for standard CPR varies markedly between the three studies, it was decided to maintain the INCEPTION control baseline with the vague prior for all analyses and to update only the eCPR arm with prior information.    

Posterior distributions are summarized with medians and 95%
highest-density intervals (credible intervals), defined as the narrowest
interval containing 95% of the probability density function
[@mcelreath2020]. We not only calculated the posterior probability of
any additional survival with eCPR (OR \>1.00), but also of clinically meaningful benefits
(defined as OR \>1.10).     

ITT assesses subjects based on the group they were initially (and randomly) allocated
to, regardless of whether or not they dropped out, were fully adhered to
the treatment or switched to an alternative treatment. ITT analyses can
therefore be seen as a conservative estimate which mirrors clinical
effectiveness. In contrast, a per protocol (PP) analysis involves a
comparison of treatment groups in a trial that includes only those
patients who completed the treatment they were originally allocated to.
Similarly an "as treated" analysis considers only which treatments
subjects received, regardless of their randomization status and protocol
adherence. While both PP and as-treated analyses alone may lead to bias,
in conjunction with an ITT analysis they may provide additional insights
into efficacy and have also been examined from a Bayesian perspective.

All analyses were executed using `R`[@R]  within the integrated development environment
of RStudio. Bayesian analyses were performed using the front end `rstanarm` package[@rstanarm] to the `Stan` programming language[stan]. The statistical code can be found on Github
(https://github.com/brophyj/eCPR).

# Results
```{r cache=TRUE}
df <- tibble(Trial = c("INCEPTION", "INCEPTION","ARREST", "ARREST", "PRAGUE", "PRAGUE"), Tx = c("CPR", "eCPR", "CPR", "eCPR", "CPR", "eCPR"),
             fail = c(52, 56, 15, 8, 108, 86),
             success = c(10,14, 0, 6,24,38 )) %>% 
  mutate(total = fail + success,
         prop_success = success / total) 
df1 <- df[, c(1:4)]  %>% tidyr::pivot_wider(names_from = Tx, values_from = c(fail,success))
#frequentist INCEPTION  to reproduce NEJM result
fit <- glm(prop_success ~ Tx, data = df[c(1:2),], family = binomial(link="logit"), weights = total)
# summary(fit, digits=3)
# print(c(exp(.262),exp(.262+c(-1,1)*1.96*.457)))
# [1] 1.300 0.531 3.183

# - INCEPTION alone default vague priors
set.seed(1234)
fit1 <- stan_glm(prop_success ~ Tx, data = df[c(1:2),], family = binomial(link="logit"), weights = total, refresh=0) #stan_glm with combined prior
fit1_sum <- summary(fit1, digits=3)
conf_95 <- c(exp(fit1_sum[2]),exp(fit1_sum[2]+c(-1,1)*1.96*fit1_sum[10]))
tt <- fit1 %>%
    spread_draws(`(Intercept)`, `TxeCPR`)
fig_prob <- sum(tt$TxeCPR>0)/nrow(tt)
# summary(fit1, digits=3)
# print(c(exp(.2785),exp(.2785+c(-1,1)*1.96*.4537)))
# get_variables(fit1)
# prior_summary(fit1)
# help('prior_summary.stanreg') 
# P > 1.1
fig_prob_1.1 <- sum(tt$TxeCPR > 0.0953)/nrow(tt) # OR >1.1 (log (1.1) = 0.0953)
# [1] 0.657

# P > 1/1.1
fig_prob_1.1.1 <- sum(tt$TxeCPR > -0.0954)/nrow(tt) # OR > 1 / 1.1 (log (0.909) = -0.0954) = 0.791

# difference equivalence 

vague_eq <- fig_prob_1.1.1 - fig_prob_1.1
```

ITT data from the INCEPTION trial[@CPR2023a] and two other pertinent trials[@RN6751;@RN6759] that also randomized CPR to eCPR are shown in Table 1. Performing a Bayesian analysis on the INCEPTION trial, using the default vague prior, produces an odds ratio (OR) 1.32 (95% Credible Interval (CrI) 0.54 - 3.22). The closeness of this result to the original analysis (OR, 1.4; 95% CI 0.5 - 3.5) confirms no impact of the vague prior and shows this Bayesian analysis is completely dominated by the observed INCEPTION data.  

One of the advantages of a Bayesian approach is the ability to make direct probability statements about the estimand of improved survival with eCPR. The eCPR probability density function for improved survival from INCEPTION data with the default vague prior is displayed in Figure 1 and reveals that the probability of enhanced survival with eCPR is `r round(fig_prob*100,2)`%. The probability that the improved survival exceeds a 10% improvement is `r round(fig_prob_1.1,2)`%.    

```{r priors, cache=TRUE}
## running using prior for eCPR from different studies but leaving CPR with vague prior and INCEPTION data since baseline risks with CPR seem 
## to vary widely btw the different studies

eCRP_bayes_no_intercept_prior <- function(data, m_eCPR, sd_eCPR ) {
  set.seed(1234)
  fit <- stan_glm(prop_success ~ Tx, data = data, family = binomial(link="logit"), weights = total, refresh=0,
                  prior = normal(m_eCPR, sd_eCPR))
  fit_sum <- summary(fit, digits=3)
  conf_95 <- c(exp(fit_sum[2]),exp(fit_sum[2]+c(-1,1)*1.96*fit_sum[10]))
  tt <- fit %>%
    spread_draws(`(Intercept)`, `TxeCPR`)
  fig_prob <- sum(tt$TxeCPR>0)/nrow(tt)
  fit_draws <- fit %>% tidybayes::tidy_draws() 
  my_list <- list(fig_prob, conf_95, fit_draws)
  return(my_list)
}

# combined_prior 
# informative priors using 2 previous studies combined
comb_m_CPR <- sum(df1[c(2,3),4]) / (sum(df1[c(2,3),4]) + sum(df1[c(2,3),2])) # proportion previous results for CPR
comb_sd_CPR <- sqrt(comb_m_CPR*(1-comb_m_CPR))                               
comb_m_eCPR <- sum(df1[c(2,3),5]) / (sum(df1[c(2,3),5]) + sum(df1[c(2,3),3])) # proportion previous results for eCPR
comb_sd_eCPR <- sqrt(comb_m_eCPR*(1-comb_m_eCPR)) #sd

# enthusiastic prior with only ARREST study
enth_m_CPR <- sum(df1[c(2),4]) + 1 / (sum(df1[c(2),4]) + sum(df1[c(2),2])) # proportion previous results for CPR, + 0.5 to avoid 0 cell
enth_sd_CPR <- sqrt(enth_m_CPR*(1-enth_m_CPR))
enth_m_eCPR <- sum(df1[c(2),5]) / (sum(df1[c(2),5]) + sum(df1[c(2),3])) # proportion previous results for eCPR
enth_sd_eCPR <- sqrt(enth_m_eCPR*(1-enth_m_eCPR)) # sd

# skeptical prior with only PRAGUE study
skep_m_CPR <- sum(df1[c(3),4])  / (sum(df1[c(3),4]) + sum(df1[c(3),2])) # proportion previous results for CPR
skep_sd_CPR <- sqrt(skep_m_CPR*(1-skep_m_CPR))
skep_m_eCPR <- sum(df1[c(3),5]) / (sum(df1[c(3),5]) + sum(df1[c(3),3])) # proportion previous results for eCPR
skep_sd_eCPR <- sqrt(skep_m_eCPR*(1-skep_m_eCPR)) #sd

comb_prior1 <-eCRP_bayes_no_intercept_prior(df[c(1:2),], comb_m_eCPR, comb_sd_eCPR) #stan_glm with combined prior
enth_prior1 <- eCRP_bayes_no_intercept_prior(df[c(1:2),], enth_m_eCPR, enth_sd_eCPR) #stan_glm with enthusiastic prior
skep_prior1 <- eCRP_bayes_no_intercept_prior(df[c(1:2),], skep_m_eCPR, skep_sd_eCPR) #stan_glm with skeptical prior

# >OR 1.1
comb_prob_1.1 <- sum(comb_prior1[[3]]$TxeCPR > 0.0953) / nrow(comb_prior1[[3]]) # OR >1.1 (log (1.1) = 0.0953) = 0.732
enth_prob_1.1 <- sum(enth_prior1[[3]]$TxeCPR > 0.0953) / nrow(enth_prior1[[3]]) # OR >1.1 (log (1.1) = 0.0953) = 0.77
skep_prob_1.1 <- sum(skep_prior1[[3]]$TxeCPR > 0.0953) / nrow(skep_prior1[[3]]) # OR >1.1 (log (1.1) = 0.0953) = 0.71

# > OR 1/ 1.1 (0.909)
comb_prob_1.1.1 <- sum(comb_prior1[[3]]$TxeCPR > -0.0954) / nrow(comb_prior1[[3]]) # OR > 1 / 1.1 (log (0.909) = -0.0954) = 0.884
enth_prob_1.1.1 <- sum(enth_prior1[[3]]$TxeCPR > -0.0954) / nrow(enth_prior1[[3]]) # OR >1 / 1.1 (log (0.909) = -0.0954) = 0.908
skep_prob_1.1.1 <- sum(skep_prior1[[3]]$TxeCPR > -0.0954) / nrow(skep_prior1[[3]]) # OR >1 / 1.1 (log (0.909) = -0.0954) = 0.878

# equivalence +/- 10%
comb_eq <- comb_prob_1.1.1 - comb_prob_1.1 
enth_eq <- enth_prob_1.1.1 - enth_prob_1.1
skep_eq <- skep_prob_1.1.1 - skep_prob_1.1
```

Another advantage of a Bayesian approach is the possibility of including previous evidence as informed priors. We considered three possible scenarios i) using all the available prior RCT data[@RN6751;@RN6759] to create a combined prior which was expressed as a N(`r round(comb_m_eCPR,2)`, `r round(comb_sd_eCPR,2)`)    
ii) using only the ARREST data, labelled an enthusiastic prior, as this trial was stopped prematurely for efficacy, expressed as a N(`r round(enth_m_eCPR,2)`, `r round(enth_sd_eCPR,2)`)    
iii) using only the PRAGUE data, labelled a skeptical prior, as this trial was stopped prematurely for futility, expressed as a N(`r round(skep_m_eCPR,2)`, `r round(skep_sd_eCPR,2)`)    

These different prior probabilities can be updated using the INCEPTION to create posterior distributions that are summarized in Table 2. Basically, in all cases the point estimate for the enhanced eCPR survival remains fairly constant but the associated uncertainty is reduced with the additional data as reflected by the narrower 95% CrI. The posterior probability of improved eCPR survival goes from 80% with a skeptical prior to 85% with the enthusiastic prior. The graphical presentation of these results is shown in Figure 2.    

Although INCEPTION did not report a per-protocol analysis, just an analysis may be revealing concerning treatment efficacy, at the risk of an increased risk of bias by not respecting the ITT. From INCEPTION Figure S4[@CPR2023a], it appears that the per protocol data for mortality is 13 survivors from 61 patients in the CPR group compared to 5 survivors from 46 patients receiving eCPR. With a vague prior, the probability of increased survival with eCPR is decreased compared to CPR but with wide CrI (OR 0.45, 95% CrI 1.5 - 1.35), limiting any definitive conclusions. The probabilities of increased eCPR survival incorporating the previous identified priors is shown in Table 3.

```{r PP, cache=TRUE}
# per protocol - only data for INCEPTION, other data just placeholder if PP data becomes available
df_pp <- tibble(Trial = c("INCEPTION", "INCEPTION","ARREST", "ARREST", "PRAGUE", "PRAGUE"), Tx = c("CPR", "eCPR", "CPR", "eCPR", "CPR", "eCPR"),
             fail = c(48, 41, 15, 8, 108, 86),
             success = c(13,5, 0, 6,24,38 )) %>% 
  mutate(total = fail + success,
         prop_success = success / total) 

# df_pp[c(1:2),] data set used for PP analyses

set.seed(1234)
fit1_pp <- stan_glm(prop_success ~ Tx, data = df_pp[c(1:2),], family = binomial(link="logit"), weights = total, refresh=0) #stan_glm with combined prior
fit1_pp_sum <- summary(fit1_pp, digits=3)
conf_95_pp <- c(exp(fit1_pp_sum[2]),exp(fit1_pp_sum[2]+c(-1,1)*1.96*fit1_pp_sum[10]))
tt_pp <- fit1_pp %>%
    spread_draws(`(Intercept)`, `TxeCPR`)
fig_prob_pp <- sum(tt_pp$TxeCPR>0)/nrow(tt_pp)
# summary(fit1, digits=3)
# print(c(exp(.2785),exp(.2785+c(-1,1)*1.96*.4537)))
# get_variables(fit1)
# prior_summary(fit1)
# help('prior_summary.stanreg') 
fig_prob_1.1_pp <- sum(tt_pp$TxeCPR>0.0953)/nrow(tt_pp) #
fig_prob_1.1.1_pp <- sum(tt_pp$TxeCPR>-0.0954)/nrow(tt_pp) 


comb_prior1_pp <-eCRP_bayes_no_intercept_prior(df_pp[c(1:2),], comb_m_eCPR, comb_sd_eCPR) #stan_glm with combined prior
enth_prior1_pp <- eCRP_bayes_no_intercept_prior(df_pp[c(1:2),], enth_m_eCPR, enth_sd_eCPR) #stan_glm with enthusiastic prior
skep_prior1_pp <- eCRP_bayes_no_intercept_prior(df_pp[c(1:2),], skep_m_eCPR, skep_sd_eCPR) #stan_glm with skeptical prior

# >OR 1.1
comb_prob_pp_1.1 <- sum(comb_prior1_pp[[3]]$TxeCPR > 0.0953) / nrow(comb_prior1_pp[[3]]) # OR >1.1 (log (1.1) = 0.0953) = 0.732
enth_prob_pp_1.1 <- sum(enth_prior1_pp[[3]]$TxeCPR > 0.0953) / nrow(enth_prior1_pp[[3]]) # OR >1.1 (log (1.1) = 0.0953) = 0.77
skep_prob_pp_1.1 <- sum(skep_prior1_pp[[3]]$TxeCPR > 0.0953) / nrow(skep_prior1_pp[[3]]) # OR >1.1 (log (1.1) = 0.0953) = 0.71

# > OR 1/ 1.1 (0.909)
comb_prob_pp_1.1.1 <- sum(comb_prior1_pp[[3]]$TxeCPR > -0.0954) / nrow(comb_prior1_pp[[3]]) # OR > 1 / 1.1 (log (0.909) = -0.0954) = 0.884
enth_prob_pp_1.1.1 <- sum(enth_prior1_pp[[3]]$TxeCPR > -0.0954) / nrow(enth_prior1_pp[[3]]) # OR >1 / 1.1 (log (0.909) = -0.0954) = 0.908
skep_prob_pp_1.1.1 <- sum(skep_prior1_pp[[3]]$TxeCPR > -0.0954) / nrow(skep_prior1_pp[[3]]) # OR >1 / 1.1 (log (0.909) = -0.0954) = 0.878

# equivalence +/- 10%
vague_eq_pp <- fig_prob_1.1.1_pp - fig_prob_1.1_pp
comb_eq_pp <- comb_prob_pp_1.1.1 - comb_prob_pp_1.1
enth_eq_pp <- enth_prob_pp_1.1.1 - enth_prob_pp_1.1
skep_eq_pp <- skep_prob_pp_1.1.1 - skep_prob_pp_1.1


```




\newpage

# Tables

```{r}
# knitr::kable(df1, caption = "Table 1 Extracted ITT trial data", col.names=c("Trial", "Fail CPR", "Fail eCPR", "Success CPR", "Success eCPR"))

gt(df1) %>%
  tab_header(
    title = "Table 1 Extracted ITT trial data"
  ) %>%
  cols_label(
    Trial = html("Trial"),
    fail_CPR = html("Fail CPR (n)"),
    fail_eCPR = html("Fail eCPR (n)"),
    success_CPR = html("Success CPR (n)"),
    success_eCPR = html("Success eCPR (n)"),
  ) %>%
  tab_style(style = cell_text(align = 'center'), locations = cells_column_labels()) %>%
  cols_align(
  align = c("center"),
  columns = c(fail_CPR, fail_eCPR, success_CPR, success_eCPR )
  ) %>%
  tab_source_note(
    source_note = "eCPR = extracorporeal cardiopulmonary resuscitation"
  ) 

## Table 2

table_tbl_2 <- 
  tibble(
    prior = c("Vague", "Combined", "Enthusiastic", "Skeptical"),
    pt_est = c(conf_95[1], comb_prior1[[2]][1], enth_prior1[[2]][1], skep_prior1[[2]][1]),
    llimit = c(conf_95[2], comb_prior1[[2]][2], enth_prior1[[2]][2], skep_prior1[[2]][2]),
    ulimit = c(conf_95[3], comb_prior1[[2]][3], enth_prior1[[2]][3], skep_prior1[[2]][3]),
    p.gt.1 = c(fig_prob, comb_prior1[1], enth_prior1[1], skep_prior1[1]),
    p.eq   = c(vague_eq, comb_eq, enth_eq, skep_eq)
  )

gt(table_tbl_2) %>%
  tab_header(
    title = "Table 2 eCPR odds ratios, 95% credible intervals and probabilities with various priors"
  ) %>%
  tab_source_note(
    source_note = "Vague: default vague prior"
  ) %>%
  tab_source_note(
    source_note = "Combined: prior eCPR data from ARREST + PRAGUE"
  ) %>%
  tab_source_note(
    source_note = md("Enthusiastic: prior eCPR data from ARREST alone")
  ) %>%
  tab_source_note(
    source_note = md("Skeptical: prior eCPR data from PRAGUE alone")
  ) %>%
  tab_source_note(
    source_note = md("ROPE: range of practical equivalence = + / - 10% OR (odds ratio)")
  ) %>%
  tab_spanner(
    label = "Priors",
    columns = c(prior)
   ) %>%
  tab_spanner(
    label = "OR",
    columns = c(pt_est)
  ) %>%
  tab_spanner(
    label = "Probabilities",
    columns = c(p.gt.1, p.eq)
   ) %>%
  tab_spanner(
    label = "95% CrI",
    columns = c(llimit, ulimit)
  ) %>%
  cols_label(
    prior = html(""),
    pt_est = html("point estimate"),
    llimit = html("lower limit"),
    ulimit = html("upper limit"),
    p.gt.1 = html("p(OR) >1 "),
    p.eq   = html(" p(ROPE)")
  ) %>%
  tab_style(style = cell_text(align = 'center'), locations = cells_column_labels()) %>%
  cols_align(
  align = c("center"),
  columns = c(pt_est, llimit, ulimit)
)

## Table 3

table_tbl_3 <- 
  tibble(
    prior = c("Vague", "Combined", "Enthusiastic", "Skeptical"),
    pt_est = c(conf_95_pp[1], comb_prior1_pp[[2]][1], enth_prior1_pp[[2]][1], skep_prior1_pp[[2]][1]),
    llimit = c(conf_95_pp[2], comb_prior1_pp[[2]][2], enth_prior1_pp[[2]][2], skep_prior1_pp[[2]][2]),
    ulimit = c(conf_95_pp[3], comb_prior1_pp[[2]][3], enth_prior1_pp[[2]][3], skep_prior1_pp[[2]][3]),
    p.gt.1 = c(fig_prob_pp, comb_prior1_pp[1], enth_prior1_pp[1], skep_prior1_pp[1]),
    p.eq   = c(vague_eq_pp, comb_eq_pp, enth_eq_pp, skep_eq_pp)
  )
 

gt(table_tbl_3) %>%
  tab_header(
    title = "Table 3 eCPR (per protocol) odds ratios, 95% credible intervals and probabilities with various priors"
  ) %>%
  tab_source_note(
    source_note = "Vague: default vague prior"
  ) %>%
  tab_source_note(
    source_note = "Combined: prior eCPR data from ARREST + PRAGUE"
  ) %>%
  tab_source_note(
    source_note = md("Enthusiastic: prior eCPR data from ARREST alone")
  ) %>%
  tab_source_note(
    source_note = md("Skeptical: prior eCPR data from PRAGUE alone")
  ) %>%
  tab_source_note(
    source_note = md("ROPE: range of practical equivalence = + / - 10% OR (odds ratio)")
  ) %>%
  tab_spanner(
    label = "Priors",
    columns = c(prior)
   ) %>%
  tab_spanner(
    label = "OR",
    columns = c(pt_est)
  ) %>%
  tab_spanner(
    label = "Probabilities",
    columns = c(p.gt.1, p.eq)
   ) %>%
  tab_spanner(
    label = "95% CrI",
    columns = c(llimit, ulimit)
  ) %>%
  cols_label(
    prior = html(""),
    pt_est = html("point estimate"),
    llimit = html("lower limit"),
    ulimit = html("upper limit"),
    p.gt.1 = html("p(OR) >1 "),
    p.eq   = html(" p(ROPE)")
  ) %>%
  tab_style(style = cell_text(align = 'center'), locations = cells_column_labels()) %>%
  cols_align(
  align = c("center"),
  columns = c(pt_est, llimit, ulimit)
)

```

\newpage

# Figures
    
          
          
```{r fig1, warning=FALSE, message=FALSE, fig.width=8}

fit1 %>% tidybayes::tidy_draws() |> 
  ggplot(aes(x = exp(TxeCPR),
             fill = after_stat(x > 1),
             slab_alpha = after_stat((x)))
  ) +
  ggdist::stat_halfeye() +
  scale_x_continuous(name="OR survival with extracorporeal CPR", limits=c(0, 5)) +
  scale_y_continuous(name="Density") +
  labs(title = "Figure 1 INCEPTION ITT analysis with vague prior", caption = "AUC to the right of vertical line at HR =1.1 = 65.7%") +
  annotate(geom="text", x=2.0,y=.6, label = "Probability of increased survival \n(with intact neurological status) \nwith extracorporeal CPR = 72.7% \n(light turquoise area under the curve (AUC) \nto the right of HR=1)", hjust = 0) +
  geom_segment(aes(x = 1.1, y = 0, xend = 1.1, yend = .90)) +
  geom_segment(aes(x = 1 / 1.1, y = 0, xend = 1 / 1.1, yend = .86)) +
  annotate(geom="text", x=2.0,y=.45, label = "Probability (range) of practical equivalence (+/- 10% OR) \nAUC between 2 black vertical lines =13.4% ", hjust = 0) +
  theme_classic() +
  theme(legend.position="none") 



```

\newpage

```{r fig2, warning=FALSE, message=FALSE, fig.height=15, fig.width=8}
g1 <- comb_prior1[[3]]  %>% tidybayes::tidy_draws() |> 
  ggplot(aes(x = exp(TxeCPR),
             fill = after_stat(x > 1),
             slab_alpha = after_stat((x)))
  ) +
  ggdist::stat_halfeye() +
  scale_x_continuous(name="OR survival with extracorporeal CPR", limits=c(0, 5)) +
  scale_y_continuous(name="Density") +
  labs(title = "Figure 2a INCEPTION ITT analysis with combined prior*", subtitle = "*data from ARREST and PRAGUE",
       caption = "AUC to the right of vertical line at HR =1.1 = 73.2%") +
  annotate(geom="text", x=2.0,y=.6, label = "Probability of increased survival \n(with intact neurological status) \nwith extracorporeal CPR = 81.2% \n(light turquoise area under the curve (AUC) \nto the right of HR=1)", hjust = 0) +
  geom_segment(aes(x = 1.1, y = 0, xend = 1.1, yend = .86)) +
  theme_classic() +
  theme(legend.position="none") 

g2 <- enth_prior1[[3]]  %>% tidybayes::tidy_draws() |> 
  ggplot(aes(x = exp(TxeCPR),
             fill = after_stat(x > 1),
             slab_alpha = after_stat((x)))
  ) +
  ggdist::stat_halfeye() +
  scale_x_continuous(name="OR survival with extracorporeal CPR", limits=c(0, 5)) +
  scale_y_continuous(name="Density") +
  labs(title = "Figure 2b INCEPTION ITT analysis with enthusiastic prior*", subtitle = "*data from ARREST alone",
       caption = "AUC to the right of vertical line at HR =1.1 = 77.0%") +
  annotate(geom="text", x=2.0,y=.6, label = "Probability of increased survival \n(with intact neurological status) \nwith extracorporeal CPR = 84.9% \n(light turquoise area under the curve (AUC) \nto the right of HR=1)", hjust = 0) +
  geom_segment(aes(x = 1.1, y = 0, xend = 1.1, yend = .77)) +
  theme_classic() +
  theme(legend.position="none") 

g3 <- skep_prior1[[3]]  %>% tidybayes::tidy_draws() |> 
  ggplot(aes(x = exp(TxeCPR),
             fill = after_stat(x > 1),
             slab_alpha = after_stat((x)))
  ) +
  ggdist::stat_halfeye() +
  scale_x_continuous(name="OR survival with extracorporeal CPR", limits=c(0, 5)) +
  scale_y_continuous(name="Density") +
  labs(title = "Figure 2c INCEPTION ITT analysis with skeptical prior*", subtitle = "*data from PRAGUE alone",
       caption = "AUC to the right of vertical line at HR =1.1 = 71.0%") +
  annotate(geom="text", x=2.0,y=.6, label = "Probability of increased survival \n(with intact neurological status) \nwith extracorporeal CPR = 80.4% \n(light turquoise area under the curve (AUC) \nto the right of HR=1)", hjust = 0) +
  geom_segment(aes(x = 1.1, y = 0, xend = 1.1, yend = .88)) +
  theme_classic() +
  theme(legend.position="none") 

g1 / g2 / g3 +
  plot_annotation(title = 'Figure 2. Probability density plots with informative priors')

```

\newpage

# References {.unnumbered}
